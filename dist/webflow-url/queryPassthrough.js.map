{
  "version": 3,
  "sources": ["../../src/webflow-core/debug.ts", "../../src/webflow-url/queryPassthrough.ts"],
  "sourcesContent": ["\r\n/*\r\n * webflow-core\r\n * \r\n * Sygnal Technology Group\r\n * http://sygnal.com\r\n * \r\n * Debug Utilities\r\n */\r\n\r\n\r\n\r\nexport class Sa5Debug {\r\n    \r\n    private localStorageDebugFlag: string = 'sa5-debug';\r\n\r\n    private _enabled: boolean = false;\r\n    private _label: string;\r\n\r\n    // Get or set WFU persistent debug state\r\n    // which is stored in localStorage. \r\n    get persistentDebug(): boolean {\r\n        return Boolean(localStorage.getItem(this.localStorageDebugFlag)); \r\n    }\r\n    set persistentDebug(active: boolean) {\r\n        if (active) {\r\n            localStorage.setItem(this.localStorageDebugFlag, \"true\");\r\n            console.debug (\"sa5-core debug enabled (persistent).\");\r\n        } else {\r\n            localStorage.removeItem(this.localStorageDebugFlag); \r\n            console.debug (\"sa5-core debug disabled (persistent).\");\r\n        }\r\n    }\r\n\r\n    // Enable/disable debugging \r\n    get enabled(): boolean {\r\n\r\n        // localStorage is checked for a debug flag, to enable remote debug enabling \r\n        // Any non-null string value will resolve to TRUE here, including the string \"false\" \r\n        var wfuDebugValue = Boolean(localStorage.getItem(this.localStorageDebugFlag)); \r\n\r\n        // Or this with the current debug state\r\n        // If either is enabled, debugging is on \r\n        wfuDebugValue = wfuDebugValue || this._enabled; \r\n\r\n        return wfuDebugValue;\r\n    }\r\n    set enabled(active: boolean) {\r\n        this._enabled = active;\r\n    }\r\n\r\n\r\n    // Initialize\r\n    constructor(label: string) {\r\n\r\n        // Save the label, for console logging\r\n        this._label = label;\r\n\r\n    }\r\n\r\n\r\n    // Start a console log group\r\n    group(name) {\r\n        if (this.enabled)\r\n            console.group(name);\r\n    }\r\n\r\n    // End a console log group\r\n    groupEnd() {\r\n        if (this.enabled)\r\n            console.groupEnd();\r\n    }\r\n\r\n    // Log debug data to the console\r\n    debug(...args: any[]): void {\r\n\r\n        if (this.enabled)\r\n            // Unlimited arguments in a JavaScript function\r\n            // https://stackoverflow.com/a/6396066\r\n            console.debug(this._label, ...args); \r\n            \r\n    }\r\n\r\n}\r\n\r\n\r\n", "\r\n/*\r\n * SA5 Url | Query Passthrough\r\n * Carries querystring info to other pages\r\n * \r\n * Sygnal Technology Group\r\n * http://sygnal.com\r\n * \r\n * Url Utilities\r\n */\r\n\r\nimport { Sa5Core } from '../webflow-core'\r\nimport { Sa5Debug } from '../webflow-core/debug';\r\n\r\n// CONFIG:\r\n// Ignore certain links?\r\n\r\nexport interface QueryPassthroughConfig {\r\n    ignorePatterns: (string | RegExp)[];\r\n    // Overwrite existing params?\r\n    overwriteExisting: boolean;\r\n    internalOnly: boolean; // Only affect internal links\r\n}\r\n\r\nexport class Sa5QueryPassthrough {\r\n\r\n    debug: Sa5Debug;\r\n\r\n    config: QueryPassthroughConfig; // Optional config\r\n\r\n    constructor(config: Partial<QueryPassthroughConfig> = {}) {\r\n\r\n\r\n        this.config = {\r\n            // Other params to ignore? user accounts login, redir params, etc.\r\n            // https://www.brojo.org/pub?b42d817d_page=2\r\n            ignorePatterns: config.ignorePatterns ?? [\r\n                /_page$/, // Ignore pagination params\r\n            ],\r\n            overwriteExisting: config.overwriteExisting ?? false,\r\n            internalOnly: config.internalOnly ?? true,\r\n        }\r\n\r\n        // Initialize debugging\r\n        // this.debug = new Sa5Debug(\"sa5-url\");\r\n        // this.debug.debug (\"Initializing\");\r\n\r\n        this.debug = new Sa5Debug(\"sa5-url-querypassthrough\");\r\n        this.debug.debug (\"Initializing\");\r\n\r\n        this.debug.debug (\"Config:\", this.config);\r\n\r\n    }\r\n\r\n    // Process elements with the custom attr wfu-query-param\r\n    init() {\r\n\r\n        document.addEventListener('click', (event: MouseEvent) => {\r\n            const target = event.target as HTMLElement;\r\n            const anchor = target.closest('a');\r\n\r\n            if (anchor) {\r\n\r\n//                console.log(\"link clicked\"); \r\n                \r\n                event.preventDefault();\r\n\r\n                const currentPageParams = new URLSearchParams(window.location.search);\r\n\r\n                // Get the parameters of the anchor URL\r\n                const anchorParams = new URLSearchParams(anchor.search);\r\n\r\n                // Parse the URL and query string\r\n                const anchorUrl = new URL(anchor.href);\r\n\r\n                // console.log(\"old url\", url.toString())\r\n                // const params = new URLSearchParams(url.search);\r\n\r\n                // Check if the URL is relative or if the hostname matches the current hostname\r\n                if(this.config.internalOnly) {\r\n\r\n                    const isRelativeOrSameHost = !anchorUrl.host || anchorUrl.host === window.location.host;\r\n\r\n                    if(!isRelativeOrSameHost) {\r\n//                        console.log(\"Not internal, skipping\");\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                event.preventDefault();\r\n\r\n                // Object to hold the new parameters\r\n//                let newParams: { [key: string]: string } = {};\r\n\r\n                let newParams: URLSearchParams = new URLSearchParams();\r\n\r\n                /**\r\n                 * Identify the query param keys we want to preserve\r\n                 */\r\n\r\n                // Iterate over existing parameters\r\n//                params.forEach((value, key) => {\r\n                for (const [key, value] of currentPageParams) {\r\n\r\n                    // if (!this.shouldIgnoreKey(key) && !anchorParams.has(key)) {\r\n                    //     anchorParams.append(key, value);\r\n\r\n//                    console.log(key, value); \r\n\r\n                    if (this.shouldIgnoreKey(key))\r\n                        continue; \r\n\r\n                    if (anchorParams.has(key) && !this.config.overwriteExisting)\r\n                        continue; \r\n\r\n//                    anchorParams[key] = value;\r\n                        \r\n                    // && !anchorParams.has(key)) {\r\n                    //     anchorParams.append(key, value);\r\n                    // }\r\n\r\n                    // // Ignore parameters ending in \"_page\" (pagination)\r\n                    // if (!key.endsWith('_page')) \r\n                    //     continue;\r\n\r\n                    // Ignore redir Webflow params (user accounts)\r\n                    // TODO: \r\n//                    console.log(\"adding\", key, value);\r\n                    // Add this one\r\n//                    newParams[key] = value;\r\n                    newParams.set(key, value);\r\n\r\n//                    console.log(newParams)\r\n                }\r\n\r\n                // Add or override other parameters as needed\r\n                // Example: newParams['newParam'] = 'newValue';\r\n\r\n                // Clear existing parameters and set the new ones\r\n//                Array.from(params.keys()).forEach(key => params.delete(key));\r\n                // params.forEach((_, key) => params.delete(key));\r\n                // // Object.entries(newParams).forEach(([key, value]) => {\r\n                // //     params.set(key, value);\r\n                // // });\r\n                // for (let key in newParams) {\r\n                //     if (newParams.hasOwnProperty(key)) {\r\n                //         params.set(key, newParams[key]);\r\n                //     }\r\n                // }\r\n\r\n\r\n//                console.log(\"writing\", newParams)\r\n\r\n\r\n                // Construct the new URL with the modified query string\r\n                let newUrl = anchorUrl.origin + anchorUrl.pathname;\r\n\r\n                if(newParams.size > 0)\r\n                    newUrl +=  '?' + newParams.toString();\r\n\r\n                // Navigate to the new URL\r\n//                console.log('Navigating to:', newUrl);\r\n                window.location.href = newUrl;\r\n            }\r\n\r\n        });\r\n\r\n    }\r\n\r\n    shouldIgnoreKey(key: string): boolean {\r\n\r\n//        console.log(\"checking\", key, this.config.ignorePatterns)\r\n\r\n        for (const pattern of this.config.ignorePatterns) {\r\n            if (typeof pattern === 'string') {\r\n                if (pattern === key) {\r\n//                    console.log(\"ignoring\", key);\r\n                    return true;\r\n                }\r\n            } else if (pattern instanceof RegExp) {\r\n                if (pattern.test(key)) {\r\n//                    console.log(\"ignoring\", key);\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n//        console.log(\"not ignoring\", key);\r\n        return false;\r\n    }\r\n\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
